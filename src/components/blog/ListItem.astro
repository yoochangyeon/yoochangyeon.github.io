---
import type { ImageMetadata } from 'astro';
import { Icon } from 'astro-icon/components';
import Image from '~/components/common/Image.astro';

import { APP_BLOG } from 'astrowind:config';
import type { Post } from '~/types';

import { getPermalink } from '~/utils/permalinks';
import { findImage } from '~/utils/images';
import { getFormattedDate } from '~/utils/utils';

export interface Props {
  post: Post;
}

const { post } = Astro.props;
const image = (await findImage(post.image)) as ImageMetadata | undefined;

const link = APP_BLOG?.post?.isEnabled ? getPermalink(post.permalink, 'post') : '';
---

<article class="bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500 transition-all overflow-hidden group">
  <a href={link ?? 'javascript:void(0)'} class="flex gap-4 p-4">
    <!-- Thumbnail (if image exists) -->
    {image && (
      <div class="flex-shrink-0 w-40 h-28">
        <Image
          src={image}
          class="w-full h-full object-cover rounded"
          widths={[200, 400]}
          width={400}
          sizes="160px"
          alt={post.title}
          aspectRatio="16:9"
          loading="lazy"
          decoding="async"
        />
      </div>
    )}

    <!-- Content -->
    <div class="flex-1 min-w-0">
      <!-- Category & Date -->
      <div class="flex items-center gap-2 mb-2 text-xs text-gray-600 dark:text-gray-400">
        {post.category && (
          <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded font-medium">
            {post.category.title}
          </span>
        )}
        <span class="flex items-center gap-1">
          <Icon name="tabler:clock" class="w-3 h-3" />
          <time datetime={String(post.publishDate)}>{getFormattedDate(post.publishDate)}</time>
        </span>
        {post.readingTime && (
          <span class="flex items-center gap-1">
            <Icon name="tabler:book" class="w-3 h-3" />
            {post.readingTime}
          </span>
        )}
      </div>

      <!-- Title -->
      <h2 class="text-lg font-bold text-gray-900 dark:text-white mb-2 line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
        {post.title}
      </h2>

      <!-- Excerpt -->
      {post.excerpt && (
        <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
          {post.excerpt}
        </p>
      )}
    </div>
  </a>
</article>
